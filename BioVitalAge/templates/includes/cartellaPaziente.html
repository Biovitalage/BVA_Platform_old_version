{% load static %}
<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- Favicon -->
        <link rel="shortcut icon" href='{% static "image/Favicon.png" %}' type="image/x-icon">
        
        {% csrf_token %}
        <meta name="csrf-token" content="{{ csrf_token }}">

        <title>BVA - Cartella Paziente</title>

        <!-- Css Import -->
        <link rel="stylesheet" href="{% static 'css/Componenti.css' %}">
        <link rel="stylesheet" href="{% static 'css/cartellaPaziente.css' %}">
        <link rel="stylesheet" href="{% static 'css/homePage.css' %}">

        <!-- Bootstrap import -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

        <!-- Font Import  -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">

        <!-- CDN IMPORT -->
        <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

        <!-- JS Import -->
        <script src="{% static 'js/cartella_paziente/prescrizioni/PrescrizioniFarmaci.js' %}" defer type="module"></script>
<!--         <script src="{% static 'js/cartellaPaziente.js' %}" defer type="module" data-user="{{user.id}}'" data-paziente="{{persona.name}}" ></script> -->

        <script>
            window.DOTTORE = "{{ dottore.nome }} {{ dottore.cognome }}";
            window.PAZIENTE = "{{ persona.name }} {{ persona.surname }}";
            window.DOB_PAZIENTE = "{{ persona.dob|date:'d/m/Y' }}";
            window.CF_PAZIENTE = "{{ persona.codice_fiscale }}";
        </script>
    </head>

    <body>
        <!-- Loader -->
        {% include 'components/loader.html' %}

        <!-- NAVBAR -->
        {% include 'components/navBar.html' %}

        <div class="side-navbar" id="sidebar">  
            <h3>Azioni Rapide</h3>
            <a href="">Visite</a>
            <a href="">Accertamenti</a>
            <a href="">Prescrizioni</a>
            <a href="">Terapia IV</a>
            <a href="">Calcolo Et√† Biologica</a>
            <a href="">Calcolo Capacit√† Vitale</a>
            <a href="">Calcolo Resilienza</a>
            <a href="">Calcolo Et√† Metabolica</a>
            <a href="">Calcolo Et√† Neurocognitiva</a>
            <a href="">Calcolo Et√† Muscolo-Scheletrica</a>
        </div>

        <div class="tools-menu">
            <button id="openSideBar"><img src="{% static 'image/menu.png' %}" alt=""></button>
            <button class="button" onclick="window.location.href='{% url 'inizia_visita' persona.id %}'"> Inizia visita</button>
        </div>

        <div class="card-paziente">
            <div class="tools-paziente">
                <button title="Modifica dati"><img src="{% static 'image/modifica.png' %}"></button>
                <button title="Note"><img src="{% static 'image/Note.png' %}" alt=""></button>
                <button title="Allegat"><img src="{% static 'image/Allegati.png' %}" alt=""></button>
                <button title="Consenso al trattamento dati"><img src="{% static 'image/privacy.png' %}" alt=""></button>
            </div>

            <div class="name-patient">
                <img src="{% static 'image/CartellaPaziente.png' %}" alt="">
                <div class="name-content">
                    <h3>{{ persona.name }}</h3>
                    <h3>{{ persona.surname }}</h3>
                </div>
            </div>

            <div class="Dati-paziente-grid">

                <div class="grid-container">
                    <div class="field">
                        <p class="field-title">Et√†:</p>
                        <input class="input-disabled" type="text" name="codice_fiscale" value="{{ persona.chronological_age |default:'non inserito' }}" disabled>
                    </div>

                    <div class="field">
                        <p class="field-title">Codice Fiscale:</p>
                        <input class="input-disabled" type="text" name="codice_fiscale" value="{{ persona.codice_fiscale|default:'non inserito' }}" disabled>
                    </div>

                    <div class="field">
                        <p class="field-title">Data di Nascita:</p>
                        <input class="input-disabled" type="text" name="dob" value="{{ persona.dob|date:'d/m/Y'|default:'non inserito' }}" disabled>
                    </div>

                    <div class="field">
                        <p class="field-title">Citt√† di nascita:</p>
                        <input class="input-disabled" type="text" name="place_of_birth" value="{{ persona.place_of_birth|title|default:'non inserito' }}" disabled>
                    </div>

                    <div class="field">
                        <p class="field-title">Citt√† di residenza:</p>
                        <input class="input-disabled" type="text" name="residence" value="{{ persona.residence|title|default:'non inserito' }}" disabled>
                    </div>

                    <div class="field">
                        <p class="field-title">CAP:</p>
                        <input class="input-disabled" type="text" name="cap" value="{{ persona.cap|default:'non inserito' }}" disabled>
                    </div>

                    <div class="field">
                        <p class="field-title">Provincia:</p>
                        <input class="input-disabled" type="text" name="province" value="{{ persona.province|default:'non inserito' }}" disabled>
                    </div>

                    <div class="field">
                        <p class="field-title">Genere:</p>
                        <input class="input-disabled" type="text" name="gender" value="{{ persona.gender|default:'non inserito' }}" disabled>
                    </div>
                </div>

                <div class="flex-container">
                    <div class="flex-card-container">
                        <div class="card-subcard">
                            <div class="img-circle-container">
                                <img src="{% static 'image/Calendario.png' %}" alt="">
                            </div>
                            <div class="container-input-info">
                                <p>Ultima Visita</p>
                                <span class="type-two cursor-not-allowed">
                                {% if prossimo_appuntamento %}{{ prossimo_appuntamento.data|date:"d/m/Y" }}
                                {% else %}non presente.{% endif %}
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="flex-card-container">
                        
                            <div class="card-subcard">
                            <div class="img-circle-container">
                                <img src="{% static 'image/Email_Violet.png' %}" alt="">
                            </div>
                            <div class="container-input-info">
                                <p>Email</p>
                                <span class="type-two cursor-not-allowed">
                                    {{ persona.email|default:'non inserito' }}
                                </span>
                            </div>
                            </div>

                            <div class="card-subcard">
                            <div class="img-circle-container">
                                <img src="{% static 'image/Phone.png' %}" alt="">
                            </div>
                            <div class="container-input-info">
                                <p>Telefono</p>
                                <span class="type-two cursor-not-allowed">
                                    {{ persona.phone|default:'non inserito' }}
                                </span>
                            </div>
                            </div>
                    </div>  
                </div>
            </div>
        </div>

        <div class="container-second-row">

<!--             <div class="container-card-score capacita_vitale"
                data-punteggio="{{ punteggio_eta_metabolica|default:'-1' }}">
               
                <div class="backdrop-riempimento" aria-hidden="true">
                <svg class="ondina" viewBox="0 0 500 100" preserveAspectRatio="none">
                    <path class="wavePath" d="M0,40 C150,100 350,-20 500,60 L500,100 L0,100 Z"></path>
                </svg>
                </div>

          
                <div class="content-layer">
                <div class="card-ondina">
                    <img src="{% static 'image/Eta_Metabolica.png' %}" alt="Et√† Metabolica" width="80" height="80">
                </div>
                <div class="container-content-card-score">
                    <h3>Et√† Metabolica</h3>
                    <p>Punteggio: {{ punteggio_eta_metabolica|default:'n.a.' }} / 100</p>
                </div>
                </div>
            </div> -->
         
            <div class="container-card-score capacita_vitale"
                data-punteggio="{{ ultimo_referto_capacita_vitale.punteggio|default:'-1' }}">
                <div class="backdrop-riempimento" aria-hidden="true">
                <svg class="ondina" viewBox="0 0 500 100" preserveAspectRatio="none">
                    <path class="wavePath" d="M0,40 C150,100 350,-20 500,60 L500,100 L0,100 Z"></path>
                </svg>
                </div>

                <div class="content-layer">
                <div class="card-ondina">
                    <img src="{% static 'image/Capacita_Vitale.png' %}" alt="Capacit√† Vitale" width="80" height="80">
                </div>
                <div class="container-content-card-score">
                    <h3>Capacit√† Vitale</h3>
                    <p>Punteggio: {{ ultimo_referto_capacita_vitale.punteggio|default:'n.a.' }} / 10</p>
                </div>
                </div>
            </div>
     
            <div class="container-card-score capacita_vitale"
                data-punteggio="{{ referti_test_recenti.resilienza|default:'-1' }}">
                <div class="backdrop-riempimento" aria-hidden="true">
                <svg class="ondina" viewBox="0 0 500 100" preserveAspectRatio="none">
                    <path class="wavePath" d="M0,40 C150,100 350,-20 500,60 L500,100 L0,100 Z"></path>
                </svg>
                </div>

                <div class="content-layer">
                <div class="card-ondina">
                    <img src="{% static 'image/Resilienza.png' %}" alt="Resilienza" width="80" height="80">
                </div>
                <div class="container-content-card-score">
                    <h3>Resilienza</h3>
                    <p>Punteggio: {{ referti_test_recenti.resilienza|default:'n.a.' }}</p>
                </div>
                </div>
            </div>

            <div class="container-card-score capacita_vitale"
                data-punteggio="{{ referti_test_recenti.eta_biologica|default:'-1' }}">
                <div class="backdrop-riempimento" aria-hidden="true">
                <svg class="ondina" viewBox="0 0 500 100" preserveAspectRatio="none">
                    <path class="wavePath" d="M0,40 C150,100 350,-20 500,60 L500,100 L0,100 Z"></path>
                </svg>
                </div>

                <div class="content-layer">
                <div class="card-ondina">
                    <img src="{% static 'image/EtaBiologica_color.png' %}" alt="Et√† Biologica" width="80" height="80">
                </div>
                <div class="container-content-card-score">
                    <h3>Et√† Biologica</h3>
                    <p>Punteggio: {{ referti_test_recenti.eta_biologica|default:'n.a.' }}</p>
                </div>
                </div>
            </div>

<!--             <div class="container-card-score capacita_vitale"
                data-punteggio="{{ referti_test_recenti.eta_neuro|default:'-1' }}">
                <div class="backdrop-riempimento" aria-hidden="true">
                <svg class="ondina" viewBox="0 0 500 100" preserveAspectRatio="none">
                    <path class="wavePath" d="M0,40 C150,100 350,-20 500,60 L500,100 L0,100 Z"></path>
                </svg>
                </div>

                <div class="content-layer">
                <div class="card-ondina">
                    <img src="{% static 'image/mente.png' %}" alt="Et√† Neurocognitiva" width="80" height="80">
                </div>
                <div class="container-content-card-score">
                    <h3>Et√† Neurocognitiva</h3>
                    <p>Punteggio: {{ referti_test_recenti.eta_neuro|default:'n.a.' }}</p>
                </div>
                </div>
            </div> -->


            <div class="container-card-score capacita_vitale" data-punteggio="{{ referti_test_recenti.microbiota|default:'-1' }}">
                <div class="backdrop-riempimento" aria-hidden="true">
                <svg class="ondina" viewBox="0 0 500 100" preserveAspectRatio="none">
                    <path class="wavePath" d="M0,40 C150,100 350,-20 500,60 L500,100 L0,100 Z"></path>
                </svg>
                </div>

                <div class="content-layer">
                    <div class="card-ondina">
                        <img src="{% static 'image/Muscolo.png' %}" alt="Et√† Muscolo Scheletrica" width="80" height="80">
                    </div>
                    <div class="container-content-card-score">
                        <h3>Et√† BioVitale</h3>
                        <p>Punteggio: {{ referti_test_recenti.microbiota|default:'n.a.' }}</p>
                    </div>
                </div>
            </div> 

        </div>

        <!-- Indicatori di performance -->
        <div class="container-indicatori containerStyle">

                <div class="card card4" id="card-style">
                    <h3 class="section-tittle">Indicatori di performance</h3>

                    <div class="score-clock-graph">
                    
                        <div class="container-clock cardIndici"
                            id="cardClick"
                            card-name="Salute del Cuore"
                            img-card="{% static 'image/Heart_Colorato.png' %}"
                            dict-value="Cuore"                   
                            >

                            <svg class="progress-ring" width="140" height="140">
                                <circle class="progress-ring__background" cx="70" cy="70" r="65"></circle>
                                <circle class="progress-ring__progress" id="heartClock" cx="70" cy="70" r="65" marker-end="url(#endDot)"></circle>
                            </svg>
                        
                            
                            <div class="percentage" id="heartPercentage"></div>
                            
                            <div class="descrizione-clock">
                                <img src="{% static 'image/Heart_Colorato.png' %}" alt="">
                                <p>Salute del Cuore</p>
                            </div>
                        </div>
                        
                        <div class="container-clock cardIndici" 
                            id="cardClick" 
                            card-name="Salute Renale"
                            img-card="{% static 'image/Reni.png' %}"
                            dict-value="Renale">

                            <svg class="progress-ring" width="140" height="140">
                                <circle class="progress-ring__background" cx="70" cy="70" r="65"></circle>
                                <circle class="progress-ring__progress" id="kidneyClock" cx="70" cy="70" r="65" marker-end="url(#endDot)"></circle>
                            </svg>
                        
                            <div class="percentage" id="kidneyPercentage"></div>
                        
                            <div class="descrizione-clock">
                                <img src="{% static 'image/Reni.png' %}" alt="">
                                <p>Et√† Metabolica</p>
                            </div>
                        </div>
                         
                        <div class="container-clock cardIndici"
                            id="cardClick"
                            card-name="Salute Epatica"
                            img-card="{% static 'image/Fegato.png' %}"
                            dict-value="Epatica">
                            <svg class="progress-ring" width="140" height="140">
                                <circle class="progress-ring__background" cx="70" cy="70" r="65"></circle>
                                <circle class="progress-ring__progress" id="liverClock" cx="70" cy="70" r="65" marker-end="url(#endDot)"></circle>
                            </svg>

                            <div class="percentage" id="liverPercentage"></div>
                        
                            <div class="descrizione-clock">
                                <img src="{% static 'image/Fegato.png' %}" alt="">
                                <p>Et√† Neurocognitiva</p>
                            </div>
                        </div>    
            
                        <!-- <div class="container-clock cardIndici"
                            id="cardClick"
                            card-name="Salute Cerebrale" 
                            img-card="{% static 'image/Cervello.png' %}"
                            dict-value="Cerebrale">
                            <svg class="progress-ring" width="140" height="140">
                                <circle class="progress-ring__background" cx="70" cy="70" r="65"></circle>
                                <circle class="progress-ring__progress" id="brainClock" cx="70" cy="70" r="65" marker-end="url(#endDot)"></circle>
                            </svg>

                            <div class="percentage" id="brainPercentage"></div>
                        
                            <div class="descrizione-clock">
                                <img src="{% static 'image/Cervello.png' %}" alt="">
                                <p>Salute Cerebrale</p>
                            </div>
                        </div> -->
                                  
                        <div class="container-clock cardIndici" 
                            id="cardClick"
                            card-name="Salute Ormonale"
                            img-card="{% static 'image/Cellula.png' %}"
                            dict-value="Ormonale">
                            <svg class="progress-ring" width="140" height="140">
                                <circle class="progress-ring__background" cx="70" cy="70" r="65"></circle>
                                <circle class="progress-ring__progress" id="hormoneClock" cx="70" cy="70" r="65" marker-end="url(#endDot)"></circle>
                            </svg>

                            <div class="percentage" id="hormonePercentage"></div>
                            
                            <div class="descrizione-clock">
                                <img src="{% static 'image/Cellula.png' %}" alt="">
                                <p>Et√† Muscolo Scheletrica</p>
                            </div>
                        </div>                
        
                        <!-- <div class="container-clock cardIndici"
                            id="cardClick" 
                            card-name="Salute del Sangue"
                            img-card="{% static 'image/Blood_Colorato.png' %}"
                            dict-value="Sangue">
                            <svg class="progress-ring" width="140" height="140">
                                <circle class="progress-ring__background" cx="70" cy="70" r="65"></circle>
                                <circle class="progress-ring__progress" id="bloodClock" cx="70" cy="70" r="65" marker-end="url(#endDot)"></circle>
                            </svg>

                            <div class="percentage" id="bloodPercentage"></div>
                            
                            <div class="descrizione-clock">
                                <img src="{% static 'image/Blood_Colorato.png' %}" alt="">
                                <p>Salute del Sangue</p>
                            </div>
                        </div> -->
                    
                        <div class="container-clock cardIndici" style="gap: 15px;" 
                            card-name="Salute del Sistema Immunitario"
                            img-card="{% static 'image/Sistema.png' %}"
                            dict-value="Immunitario">
                            <svg class="progress-ring" width="140" height="140">
                                <circle class="progress-ring__background" cx="70" cy="70" r="65"></circle>
                                <circle class="progress-ring__progress" id="immuneClock" cx="70" cy="70" r="65" marker-end="url(#endDot)"></circle>
                            </svg>

                            <div class="percentage" id="immunePercentage" style="margin-top: 5px;"></div>
                        
                            <div class="descrizione-clock" style="margin-bottom: -14px;">
                                <img src="{% static 'image/Sistema.png' %}" alt="">
                                <p style="max-width: 60%; font-size: 14px;">Salute del Sistema Immunitario</p>
                            </div>
                        </div>
                                  
                        <div class="container-clock" onclick="window.location.href ='{% url 'microbiota_detail' persona.id %}'" style="cursor: pointer; height: 280px;">
                            <svg class="progress-ring" width="140" height="140">
                                <circle class="progress-ring__background" cx="70" cy="70" r="65"></circle>
                                <circle class="progress-ring__progress" id="muscleClock" cx="70" cy="70" r="65" marker-end="url(#endDot)"></circle>
                            </svg>

                            <div class="percentage" id="musclePercentage" style="margin-top: 5px;"></div>
                    
                            <div class="descrizione-clock" style="margin-top: 5px;">
                                <img src="{% static 'image/Microbiota.png' %}" alt="">
                                
                                <a style="text-decoration: none; color: #3a255d;" href="{% url 'microbiota_detail' persona.id %}">Microbiota</a>
                            
                            </div>
                        </div>
                    </div>

                    
                </div>
                
        </div> 


        <div class="card-azioni">
            <div class="card-card-azioni">
                <img src="{% static 'image/accertamenti.png' %}" alt="">
                <div class="content-card-azione">
                    <h3>Accertamenti</h3>
                    <a href="">Vai alla Sezione ü†ñ</a>
                </div>
            </div>
            <div class="card-card-azioni">
                <img src="{% static 'image/prescrizioni.png' %}" alt="">
                <div class="content-card-azione">
                    <h3>Prescrizioni</h3>
                    <a href="">Vai alla Sezione ü†ñ</a>
                </div>
            </div>
            <div class="card-card-azioni">
                <img src="{% static 'image/terapia.png' %}" alt="">
                <div class="content-card-azione">
                    <h3>Terapie IV</h3>
                    <a href="">Vai alla Sezione ü†ñ</a>
                </div>
            </div>
        </div>

<div class="diario-clinico">
  <div class="diario-clinico-title">
    <h3>Diario Clinico</h3>
    <div class="switch-diario" role="tablist" aria-label="Sezioni diario clinico">
      <button class="switch-btn switch-active" data-tab="visite" aria-selected="true" role="tab">Visite</button>
      <button class="switch-btn" data-tab="farmaci" aria-selected="false" role="tab">Farmaci</button>
      <button class="switch-btn" data-tab="accertamenti" aria-selected="false" role="tab">Accertamenti</button>
    </div>
  </div>

  <!-- UNICA TABELLA -->
  <div class="table-diario" role="tabpanel" aria-live="polite">
    <div class="header-diario" id="diario-header"><!-- riempito da JS --></div>
    <div id="diario-rows"><!-- riempito da JS --></div>
  </div>
</div>

<!-- ====== TEMPLATES NASCOSTI ====== -->
<!-- Header Visite -->
<template id="tmpl-header-visite">
  <div>Numero visita</div>
  <div>Data visita</div>
  <div>Preview valori</div>
  <div>Scarica referto</div>
</template>

<!-- Righe Visite -->
<template id="tmpl-rows-visite">
  {% if visite_page %}
    {% for v in visite_page %}
      <div class="celle-diario">
        <div class="cella"><p>{{ v.visita_numero }}</p></div>
        <div class="cella"><p>{{ v.data_visita|date:"d/m/Y" }}</p></div>
        <div class="cella">
          <button type="button" class="btn-disabled" disabled aria-disabled="true" title="Presto disponibile">Preview</button>
        </div>
        <div class="cella">
          <button type="button" class="btn-disabled" disabled aria-disabled="true" title="Presto disponibile">
            <img src="{% static 'image/download.png' %}" alt="Scarica referto">
          </button>
        </div>
      </div>
    {% empty %}
      <div class="celle-diario">
        <div class="cella" style="grid-column:1 / -1;"><p>Nessuna visita registrata.</p></div>
      </div>
    {% endfor %}

    {% if visite_page.paginator.num_pages > 1 %}
      <div class="add-cella">
        {% if visite_page.has_previous %}
          <a class="page-link" href="?visite_page={{ visite_page.previous_page_number }}">¬´</a>
        {% endif %}
        <span class="page-current">{{ visite_page.number }} / {{ visite_page.paginator.num_pages }}</span>
        {% if visite_page.has_next %}
          <a class="page-link" href="?visite_page={{ visite_page.next_page_number }}">¬ª</a>
        {% endif %}
      </div>
    {% endif %}
  {% endif %}
</template>

<!-- Header Farmaci -->
<template id="tmpl-header-farmaci">
  <div>Data prescrizione</div>
  <div>Farmaci prescritti</div>
  <div>Note</div>
  <div>Scarica Prescrizione</div>
</template>

<!-- Righe Farmaci -->
<template id="tmpl-rows-farmaci">
  {% for f in farmaci_prescritti %}
    <div class="celle-diario">
      <div class="cella"><p>{{ f.data_prescrizione|date:"d/m/Y" }}</p></div>
      <div class="cella"><p>{{ f.farmaco.nome_farmaco }}</p></div>
      <div class="cella"><p>{{ f.note_medico|default:"‚Äî" }}</p></div>
      <div class="cella">
        <button type="button" class="btn-disabled" disabled aria-disabled="true" title="Presto disponibile">
          <img src="{% static 'image/download.png' %}" alt="Scarica">
        </button>
      </div>
    </div>
  {% empty %}
    <div class="celle-diario">
      <div class="cella" style="grid-column:1 / -1;"><p>Nessuna prescrizione trovata.</p></div>
    </div>
  {% endfor %}
</template>

<!-- Header Accertamenti -->
<template id="tmpl-header-accertamenti">
  <div>Data</div>
  <div>Esami prescritti</div>
  <div>Diagnosi</div>
  <div>Scarica</div>
</template>

<!-- Righe Accertamenti -->
<template id="tmpl-rows-accertamenti">
  {% for a in accertamenti_qs %}
    <div class="celle-diario">
      <div class="cella"><p>{{ a.data_visita|date:"d/m/Y" }}</p></div>
      <div class="cella"><p>{{ a.esami_prescritti }}</p></div>
      <div class="cella"><p>{{ a.diagnosi|default:"‚Äî" }}</p></div>
      <div class="cella">
        <button type="button" class="btn-disabled" disabled aria-disabled="true" title="Presto disponibile">
          <img src="{% static 'image/download.png' %}" alt="Scarica">
        </button>
      </div>
    </div>
  {% empty %}
    <div class="celle-diario">
      <div class="cella" style="grid-column:1 / -1;"><p>Nessun accertamento presente.</p></div>
    </div>
  {% endfor %}
</template>

<script>
  (function () {
    const btns = document.querySelectorAll('.switch-diario .switch-btn');
    const header = document.getElementById('diario-header');
    const rows = document.getElementById('diario-rows');

    const templates = {
      visite: {
        head: document.getElementById('tmpl-header-visite'),
        body: document.getElementById('tmpl-rows-visite'),
      },
      farmaci: {
        head: document.getElementById('tmpl-header-farmaci'),
        body: document.getElementById('tmpl-rows-farmaci'),
      },
      accertamenti: {
        head: document.getElementById('tmpl-header-accertamenti'),
        body: document.getElementById('tmpl-rows-accertamenti'),
      }
    };

    function renderTab(tab) {
      const tpl = templates[tab];
      if (!tpl) return;
      header.innerHTML = tpl.head.innerHTML;
      rows.innerHTML = tpl.body.innerHTML;

      // stato pulsanti (UI/ARIA)
      btns.forEach(b => {
        const isActive = b.dataset.tab === tab;
        b.classList.toggle('switch-active', isActive);
        b.setAttribute('aria-selected', isActive ? 'true' : 'false');
      });
    }

    // inizializza su VISITE (tab default)
    renderTab('visite');

    // listeners
    btns.forEach(b => {
      b.addEventListener('click', () => renderTab(b.dataset.tab));
    });
  })();
</script>


        <script src="{% static 'js/cartellaP.js' %}"></script>
    </body>
</html>